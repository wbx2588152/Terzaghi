<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>LayuiDemo</title>
    <link th:href="@{/layui/css/layui.css}" rel="stylesheet"/>
    <script th:src="@{/layui/layui.js}"></script>
</head>
<body>
<div style="text-align: center">
    <h1>转盘管理列表</h1>

    <br/>
    <div class="demoTable">
        搜索姓名：
        <div class="layui-inline">
            <input class="layui-input" name="name" id="name" autocomplete="off">
        </div>
        <button class="layui-btn" data-type="reload">搜索</button>

    </div>

    <!--class="layui-hide"-->
    <table  id="test" lay-filter="test" ></table>
    <!--操作列-->
    <script type="text/html" id="barDemo">
        <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    </script>

</div>
<script>

    layui.use('table', function(){
        var table = layui.table;
        table.render({
            elem: '#test'
            ,url:'/topo/getlunpan'
            ,page: true
            ,id: 'testReload'
            ,width:1400
            ,cols: [
                [
                    {field:'id', width:95, title: '编号',align: 'center'},
                    {field:'probability', width:90, title: '中奖概率',align: 'center'},
                    {field:'name', width:150, title: '中奖名称',align: 'center'},
                    {field:'linshi', width:150, title: '中奖概率',align: 'center'},
                    {field:'', title: '操作', align: 'center',width:333,toolbar:"#barDemo"}
                ]
            ]
        });
        /*重新加载数据表格*/
        var $ = layui.$, active = {
            reload: function(){
                var name = $('#name');
                table.reload('testReload', {
                    where: {
                        name: name.val()
                    }
                });
            }
        };

        /*绑定搜索点击事件*/
        $('.demoTable .layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });

        //监听工具条
        table.on('tool(test)', function(obj){
            var data = obj.data;
            if(obj.event === 'detail'){
                layer.open({
                    type: 2,
                    title:"查看详情"
                    ,area: ['700px', '500px']
                    ,id: 'toDetail' //防止重复弹出
                    ,content: "/toDetail?id="+data.id
                    ,btnAlign: 'c' //按钮居中
                    ,shade: 0.1 //不显示遮罩
                    ,yes: function(){
                        layer.closeAll();
                    },
                    success: function(layero, index){
                        console.log(layero, index);
                    }
                });
            } else if(obj.event === 'del'){
                layer.confirm('真的删除行么', function(index){
                    //console.log(data);
                    $.ajax({
                        url: "/topo/delete",
                        type: "POST",
                        data:{"stockid":data.stockid},
                        dataType: "json",
                        success: function(data){
                            if(data==1){
                                layer.msg("删除成功", {icon: 6});
                                /*重新加载数据表格*/
                                var name = $('#name');
                                table.reload('testReload', {
                                    where: {
                                        name: name.val()
                                    }
                                });
                            }else{
                                layer.msg("删除失败", {icon: 5});
                            }
                        }

                    });
                });
            } else if(obj.event === 'edit'){
                layer.open({
                    type: 2,
                    title:"修改用户"
                    ,area: ['700px', '500px']
                    ,id: 'toUpdate' //防止重复弹出
                    ,content: "/topo/toUpdate?id="+data.id
                    //,btn: ['确认', '取消']
                    ,btnAlign: 'c' //按钮居中
                    ,shade: 0.1 //不显示遮罩
                    ,yes: function(){
                        layer.closeAll();
                    },
                    success: function(layero, index){
                        console.log(layero, index);
                    }
                });

            }
        });
    });
</script>

</body>
</html>