!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("base/MoGu")):"function"==typeof define&&define.amd?define("pc/pages/user-coupon/index",["base/MoGu"],e):"object"==typeof exports?exports["pc/pages/user-coupon/index"]=e(require("base/MoGu")):t["pc/pages/user-coupon/index"]=e(t["base/MoGu"])}(this,function(t){return function(t){function e(a){if(n[a])return n[a].exports;var i=n[a]={exports:{},id:a,loaded:!1};try{t[a].call(i.exports,i,i.exports,e)}catch(o){if("string"==typeof o&&(o=new Error(o)),o.hasReported)return;throw o.hasReported=!0,window._trace&&window._trace.sendMsg&&"function"==typeof window._trace.sendMsg&&window._trace.sendMsg(o),console&&console.warn&&console.warn(o),o}return i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";n(1),n(5),n(11),window.pub_navlist_wrap_init&&pub_navlist_wrap_init.init()},function(t,e,n){function a(t){return t&&t.__esModule?t:{"default":t}}var i,o,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c=n(2),r=a(c);n(3);i=[n(4)],o=function(t){var e=t.module.extend({$el:$("#content_tabs"),model:{url:"/ajax/getBuyerResourceTab/2",params:{marketType:"market_mogujie",source:1},type:"GET",timeout:12e3},init:function(){this.render()},render:function(){var e=this;this.fetch(function(n){var a=n.data.tabs||[],i=window.location.pathname.replace(/\/$/g,"");e.$el.html(t.ui.getTemplate(r["default"],{tabs:a,pathname:i}))},function(t){})},fetch:function(t,e){var n=this.model;$.ajax({url:n.url,data:n.params,type:n.type,dataType:n.dataType,timeout:n.timeout}).done(function(n){"object"!==("undefined"==typeof n?"undefined":s(n))&&(n=JSON.parse(n)),n.success&&"SUCCESS"===n.returnCode?t&&t(n):e&&e(n)}).fail(function(){window.alert("\u8bf7\u6c42\u8d85\u65f6\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5\uff5e")})}});e.init()}.apply(e,i),!(void 0!==o&&(t.exports=o))},function(t,e){t.exports='<div class="main-tab">\n  {{~ it.tabs :tab:index }}\n    <a class="main-tab__item {{? tab.pcUrl == it.pathname }}active{{?}}" href="//promotion.mogujie.com{{= tab.pcUrl }}">{{= tab.title }}</a>\n  {{~}}\n</div>\n'},function(t,e){"use strict";t.exports={getQueryString:function(t,e){e=null==e?window.location.href:e,e=e.split("#")[0];var n=new RegExp("(^|\\?|&)"+t+"=([^&]*)(\\s|&|$)","i");return n.test(e)?decodeURIComponent(RegExp.$2.replace(/\+/g," ")):""},isLogin:function(t){return detailInfo.isLogin?!0:(this.goToLogin(),!1)},goToLogin:function(){return this.getQueryString("__stoplogin")?(window.console&&console.log("\u51c6\u5907\u8df3\u8f6c\u5230\u767b\u5f55\u9875\u9762\uff0c\u4f46\u662f\uff0c\u4f46\u662f\u88ab\u963b\u6b62\u4e86~~~"),!1):void(location.href=this.getUrlWithPtp("//www.meilishuo.com/user/login"))},getUrlWithPtp:function(t){return window.logger?logger.generatePtpParams(t):t},getCouponType:function(){var t="shop",e=window.location.pathname.replace(/\/$/g,"");return/cashcoupon/.test(e)?t="platform":/activitycoupon/.test(e)&&(t="activity"),t}}},function(e,n){e.exports=t},function(t,e,n){function a(t){return t&&t.__esModule?t:{"default":t}}var i,o,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c=n(3),r=(a(c),n(6)),p=a(r),l=n(7),u=a(l),d=n(8),m=a(d);n(9);var f=n(10),v=a(f);i=[n(4)],o=function(t){var e=t.module.extend({$el:$("#content_coupon"),pathname:window.location.pathname,model:{template:"",url:"",params:{},type:"GET",timeout:12e3,couponList:[]},init:function(){this.getUrlParams(),this.render()},getUrlParams:function(){var t=this.pathname.match(/\/(\w+)\/?$/i)[1],e=(0,c.getCouponType)();switch(t){case"activitycoupon":case"cashcoupon":this.model.url="/ajax/getMyCouponList/3",this.model.params={couponType:e,marketType:"market_mogujie",needSubParticipate:!1,page:parseInt((0,c.getQueryString)("page"))||1,status:parseInt((0,c.getQueryString)("status"))||1},this.model.template=p["default"];break;case"shopcoupon":this.model.url="/ajax/getMyCouponList/3",this.model.params={couponType:e,marketType:"market_mogujie",needSubParticipate:!1,page:parseInt((0,c.getQueryString)("page"))||1,status:parseInt((0,c.getQueryString)("status"))||1},this.model.template=u["default"];break;case"redpacket":this.model.url="/ajax/getMyRedPacketList/1",this.model.params={campaignId:"",page:parseInt((0,c.getQueryString)("page"))||1},this.model.template=m["default"];break;default:this.model.url="/ajax/getMyCouponList/3",this.model.params={couponType:e,marketType:"market_mogujie",needSubParticipate:!1,page:parseInt((0,c.getQueryString)("page"))||1,status:parseInt((0,c.getQueryString)("status"))||1},this.model.template=p["default"]}},render:function(){var t=this,e=this.model;"undefined"!=typeof e.params.campaignId?!function(){var e=22484;$.ajax({url:"//mce.mogujie.com/jsonp/multiget/3",data:{pids:e},type:"GET",dataType:"jsonp",timeout:12e3}).done(function(n){n.success&&"SUCCESS"===n.returnCode&&(t.model.params.campaignId=n.data&&n.data[e]&&n.data[e].list&&n.data[e].list.length?n.data[e].list[0].redpacketId:"",t.renderCoupon())}).fail(function(){})}():t.renderCoupon()},addEvents:function(){var t=this;$("#content_coupon_status").on("change",function(){t.model.params.status=parseInt($(this).val()),t.model.params.page=1,t.render()}),$("#recommend_tabs").delegate("li","click",function(){var e=$(this).data("status");e!=t.model.params.status&&(t.model.params.page=1,t.model.params.status=e,t.render())}),$(".use_now").on("click",function(){var e=$(this).data("type");if(t.model.couponList.length&&t.model.couponList){var n=t.model.couponList[e].channels;n&&n.length&&-1!==n.indexOf(3)?$.alert("\u8be5\u4f18\u60e0\u5238\u53ea\u80fd\u5728APP\u4e0a\u4f7f\u7528"):($(this).attr("href","//www.mogujie.com/"),$(this).attr("target","_blank"))}})},fetch:function(t,e){var n=this.model;$.ajax({url:n.url,data:n.params,type:n.type,dataType:n.dataType,timeout:n.timeout}).done(function(n){"object"!==("undefined"==typeof n?"undefined":s(n))&&(n=JSON.parse(n)),n.success&&"SUCCESS"===n.returnCode?t&&t(n):"SESSION_INVALID"===n.returnCode?window.location.href=(0,c.getUrlWithPtp)("//portal.mogujie.com/user/login"):e&&e(n)}).fail(function(){window.alert("\u83b7\u53d6\u6570\u636e\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5\uff5e")})},renderCoupon:function(){var e=this,n=this.model;this.fetch(function(a){n.couponList=a.data.list,e.$el.html(t.ui.getTemplate(n.template,{list:a.data.list||[],status:n.params.status})),e.addEvents();var i="undefined"!=typeof n.params.status?"?status="+n.params.status+"&":"?";$("#content_pagination").html(t.ui.getTemplate(v["default"],{curPage:n.params.page,totalPage:+a.data.totalPage,path:e.pathname+i}))},function(t){window.alert(t.message||"\u83b7\u53d6\u6570\u636e\u5931\u8d25\uff5e")})}});e.init()}.apply(e,i),!(void 0!==o&&(t.exports=o))},function(t,e){t.exports='<ul class="coupon-wrapper">\n  <ul class="coupon-tabs" id="recommend_tabs">\n    <li class="{{? it.status == 1 }}active{{?}}" data-status="1">\u672a\u4f7f\u7528</li>\n    <li class="{{? it.status == 2 }}active{{?}}" data-status="2">\u5df2\u4f7f\u7528</li>\n    <li class="{{? it.status == 3 }}active{{?}}" data-status="3">\u5df2\u8fc7\u671f</li>\n  </ul>\n  \n  <ul class="coupon-list">\n    {{? it.list.length }}\n      {{~ it.list :item:index }}\n        <li class="coupon-card {{? item.status != 0 && item.status != -1 }}gray{{?}}">\n          <div class="fl left">\n            <div>\n              <p class="title">{{= item.title }}</p>\n            </div>\n            {{? item.needDiscount}}\n            <h3 class="price">{{= item.discount }}\u6298</h3>\n            <p>\u4f7f\u7528\u8bf4\u660e\uff1a\u6700\u9ad8\u51cf{{= item.maxDecrease }}\u5143{{?item.couponType===\'activity\'}}\u3001\u5238\u4e0d\u9000{{?}}</p>\n            {{?? }}\n            <h3 class="price"><span>\uffe5</span>{{= (item.cutPrice / 100).toFixed(2) }}</h3>\n            <p>\u4f7f\u7528\u8bf4\u660e\uff1a{{= item.limitPriceDesc }}{{?item.couponType===\'activity\'}}\u3001\u5238\u4e0d\u9000{{?}}</p>\n            {{?}}\n            <p class="time">\n              <span>\u4f7f\u7528\u671f\u9650\uff1a</span>\n              {{= item.startTimeDesc || (new Date(item.startTime * 1000)).toFormattedString(\'yyyy.MM.dd HH:mm\') }}\n              \u81f3<br>\n              {{= item.endTimeDesc || (new Date(item.endTime * 1000)).toFormattedString(\'yyyy.MM.dd HH:mm\') }}\n            </p>\n            <p>\u4f7f\u7528\u5e73\u53f0\uff1a{{= item.restrictDesc || \'\' }}</p>\n          </div>\n          <div class="fl right">\n            <p {{? item.status == 0 }}style="margin-top:-32px"{{?}}>\n              {{? item.status == 0 }}\n                <a class="use_now" data-type="{{=index}}">\u7acb\u5373<br>\u4f7f\u7528</a>\n              {{?? item.status == -1 }}\n                \u672a\u5f00\u59cb\n              {{?? item.status == 1 }}\n                \u5df2\u4f7f\u7528\n              {{??}}\n                \u5df2\u8fc7\u671f\n              {{?}}\n            </p>\n          </div>\n        </li>\n      {{~}}\n    {{??}}\n      <div class="coupon-empty">\u6682\u65e0\u4f18\u60e0\u5238~</div>\n    {{?}}\n  </ul>\n</div>'},function(t,e){t.exports='<ul class="coupon-wrapper">\n  {{? it.isRecommend }}\n    <div class="coupon-title">\u66f4\u591a\u5e97\u94fa\u4f18\u60e0</div>\n  {{??}}\n    <ul class="coupon-tabs" id="recommend_tabs">\n      <li class="{{? it.status == 1 }}active{{?}}" data-status="1">\u672a\u4f7f\u7528</li>\n      <li class="{{? it.status == 2 }}active{{?}}" data-status="2">\u5df2\u4f7f\u7528</li>\n      <li class="{{? it.status == 3 }}active{{?}}" data-status="3">\u5df2\u8fc7\u671f</li>\n    </ul>\n  {{?}}\n  \n  <ul class="coupon-list">\n    {{? it.list.length }}\n      {{~ it.list :item:index }}\n        <li class="coupon-card {{? item.status != 0 && item.status != -1 }}gray{{?}}">\n          <div class="fl left">\n            <div>\n              <p class="title">{{= item.shopName }}</p>\n              <p class="scope">{{? item.scope }}\u5168\u5e97\u901a\u7528{{??}}\u90e8\u5206\u5546\u54c1\u53ef\u7528{{?}}</p>\n            </div>\n            <h3 class="price"><span>\uffe5</span>{{= (item.cutPrice / 100).toFixed(2) }}</h3>\n            <p>\u4f7f\u7528\u8bf4\u660e\uff1a{{= item.limitPriceDesc }}</p>\n            <p class="time">\n              <span>\u4f7f\u7528\u671f\u9650\uff1a</span>\n              {{= item.startTimeDesc || (new Date(item.startTime * 1000)).toFormattedString(\'yyyy.MM.dd HH:mm\') }}\n              \u81f3<br>\n              {{= item.endTimeDesc || (new Date(item.endTime * 1000)).toFormattedString(\'yyyy.MM.dd HH:mm\') }}\n            </p>\n            <p>\u4f7f\u7528\u5e73\u53f0\uff1a\u5168\u5e73\u53f0</p>\n          </div>\n          <div class="fl right">\n            <p {{? item.status == 0 }}style="margin-top:-32px"{{?}}>\n              {{? item.status == 0 }}\n                <a href="//shop.mogujie.com/{{= item.shopId }}" target="_blank">\u7acb\u5373<br>{{? it.isRecommend }}\u9886\u53d6{{??}}\u4f7f\u7528{{?}}</a>\n              {{?? item.status == -1 }}\n                \u672a\u5f00\u59cb\n              {{?? item.status == 1 }}\n                \u5df2\u4f7f\u7528\n              {{??}}\n                \u5df2\u8fc7\u671f\n              {{?}}\n            </p>\n          </div>\n        </li>\n      {{~}}\n    {{??}}\n      <div class="coupon-empty">\u6682\u65e0\u4f18\u60e0\u5238\uff0c\u5feb\u53bb\u9886\u5238\u8d2d\u7269\u5427~</div>\n    {{?}}\n  </ul>\n</div>'},function(t,e){t.exports='<table class="main-coupon">\n  <thead>\n    <tr>\n      <th>\u6536\u652f</th>\n      <th>\u91d1\u989d</th>\n      <th>\u540d\u79f0</th>\n      <th>\u4f7f\u7528\u8bf4\u660e\uff0f\u7528\u9014</th>\n    </tr>\n  </thead>\n  <tbody>\n    {{~ it.list :item:index }}\n      <tr class="main-coupon__available">\n        <td>\n          <b class="{{? item.status == 1 || item.status == 3 }}icon-redpacket{{?? item.status == 2 }}icon-redpacket grey{{?}}"></b>\n        </td>\n        <td>{{= item.price }}\u5143</td>\n        <td>{{= item.title }}</td>\n        <td>{{= item.desc }}</td>\n      </tr>\n    {{~}}\n  </tbody>\n</table>\n'},function(t,e){"use strict";window.MOGU=window.MOGU||{},function(t,e){var n={};n.Util={mask:function(){var e=t(".light_box_fullbg");e.length<=0&&(e=t(['<div class="light_box_fullbg"></div>'].join("")),t("body").append(e))},show:function(e,n){var a,i,o,s=t("#vp_wrap"),c=t(".light_box_fullbg").eq(0);s.length<=0&&(s=t(['<div class="vp_wrap" id="vp_wrap">','<h5 class="vp_t"></h5>','<a href="javascript:;" class="vp_cls">\xd7</a>','<div class="v_pop_box"></div>',"</div>"].join("")),t("body").append(s),c.off("click").on("click",function(){clearTimeout(o),s.addClass("vp_shake"),o=setTimeout(function(){s.removeClass("vp_shake")},500)})),n.isShowCloser?s.find(".vp_cls").show():s.find(".vp_cls").hide(),s.find(".vp_t").html(n.title),i={alert:function(e){return a=t(".vp_alert"),a.length<=0?a=t(['<div class="vp_alert vp_inner">','<p class="vp_cnt"></p>','<a href="javascript:;" class="vp_btn vp_btn_'+e.btn.theme+' vp_ok">'+e.btn.text+"</a>","</div>"].join("")):a.find(".vp_btn").removeClass("vp_btn_red").removeClass("vp_btn_normal").addClass("vp_btn_"+e.btn.theme).html(e.btn.text),a.show().find(".vp_cnt").html(e.content),a},confirm:function(e){if(a=t(".vp_cfm"),a.length<=0)a=t(['<div class="vp_cfm vp_inner">','<p class="vp_cnt"></p>','<a href="javascript:;" class="vp_btn vp_btn_'+e.btn1.theme+' vp_ok">'+e.btn1.text+"</a>",'<a href="javascript:;" class="vp_btn vp_btn_'+e.btn2.theme+' vp_cancel">'+e.btn2.text+"</a>","</div>"].join(""));else{var n=a.find(".vp_btn");n.removeClass("vp_btn_red").removeClass("vp_btn_normal"),n.eq(0).addClass("vp_btn_"+e.btn1.theme).html(e.btn1.text),n.eq(1).addClass("vp_btn_"+e.btn2.theme).html(e.btn2.text)}return a.show().find(".vp_cnt").html(e.content),a}},s.find(".v_pop_box").append(i[e](n)),s.css({display:"block",opacity:0}).css({"margin-left":-s.width()/2-1,"margin-top":-s.height()/2-1,opacity:1}),c.show()},close:function(e,n){t(".light_box_fullbg").eq(0).hide(),t("#vp_wrap").find(".vp_inner").hide().end().hide(),void 0!==n&&"function"==typeof n&&n(e)}},t.alert=function(e,a,i){var o=t.extend(!0,{title:"\u63d0\u793a",content:e,btn:{text:"\u786e\u5b9a",theme:"red",val:void 0},isShowCloser:!0,close_val:void 0},i),s=function(){t("#vp_wrap").off("click").on("click",".vp_ok",function(t){t.preventDefault(),n.Util.close(o.btn.val,a)}).on("click",".vp_cls",function(t){t.preventDefault(),n.Util.close(o.close_val,a)})};!function(){n.Util.mask(),n.Util.show("alert",o),s()}()},t.confirm=function(e,a,i){var o=t.extend(!0,{title:"\u63d0\u793a",content:e,btn1:{text:"\u786e\u5b9a",theme:"red",val:!0},btn2:{text:"\u53d6\u6d88",theme:"normal",val:!1},isShowCloser:!0,close_val:!1},i),s=function(){t("#vp_wrap").off("click").on("click",".vp_ok",function(t){t.preventDefault(),n.Util.close(o.btn1.val,a)}).on("click",".vp_cancel",function(t){t.preventDefault(),n.Util.close(o.btn2.val,a)}).on("click",".vp_cls",function(t){t.preventDefault(),n.Util.close(o.close_val,a)})};!function(){n.Util.mask(),n.Util.show("confirm",o),s()}()},e.MOGU.alert=t.alert,e.MOGU.confirm=t.confirm}(jQuery,window)},function(t,e){t.exports='{{? it.totalPage > 1 }}\n  <div class="main-pagination">\n      {{? it.curPage > 1 }}\n        <a href="{{= it.path }}page={{= it.curPage - 1 }}" class="prev">< \u4e0a\u4e00\u9875</a>\n      {{?}}\n      {{ for (var i = 1; i <= it.totalPage; i++) { }}\n        {{? i === it.curPage }}\n          <a href="javascript:;" class="cur">{{= i }}</a>\n        {{??}}\n          <a href="{{= it.path }}?page={{= i }}">{{= i }}</a>\n        {{?}}\n      {{ } }}\n      {{? it.curPage < it.totalPage }}\n        <a href="{{= it.path }}?page={{= it.curPage + 1 }}" class="next">\u4e0b\u4e00\u9875 ></a>\n      {{?}}\n  </div>\n{{?}}\n'},function(t,e,n){function a(t){return t&&t.__esModule?t:{"default":t}}var i,o,s=n(7),c=a(s);i=[n(4)],o=function(t){var e=t.module.extend({$el:$("#content_recommend"),model:{url:"//mce.mogucdn.com/jsonp/get/3",params:{pid:42951},type:"GET",dataType:"jsonp",timeout:12e3},init:function(){this.render()},render:function(){var e=this,n=window.location.pathname.match(/\/(\w+)\/?$/);n&&n[1]&&"shopcoupon"===n[1]&&this.fetch(function(n){var a=n&&n.data&&n.data.list||[];a=a.map(function(t){return{shopName:t.shopName,cutPrice:100*+t.reduce,scope:"\u5168\u5e97"===t.scope,limitPriceDesc:"\u6ee1"+t.over+"\u5143\u53ef\u7528",startTimeDesc:t.effectSTimeDesc,endTimeDesc:t.effectETimeDesc,shopId:t.shop_id,status:0}}),e.$el.html(t.ui.getTemplate(c["default"],{list:a,isRecommend:!0}))},function(t){})},fetch:function(t,e){var n=this.model;$.ajax({url:n.url,data:n.params,type:n.type,dataType:n.dataType,timeout:n.timeout}).done(function(n){n.success&&"SUCCESS"===n.returnCode?t&&t(n):e&&e(n)}).fail(function(){window.alert("\u8bf7\u6c42\u8d85\u65f6\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5\uff5e")})}});e.init()}.apply(e,i),!(void 0!==o&&(t.exports=o))}])}),"function"==typeof define&&define.amd&&require(["pc/pages/user-coupon/index"]);